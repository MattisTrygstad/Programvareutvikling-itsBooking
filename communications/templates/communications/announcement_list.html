{% extends 'itsBooking/base.html' %}
{% load static %}
{% load helpers %}
{% block body %}
    
    <div class="uk-container uk-container-small">
        {% if request.user|in_group:"course_coordinators" %}
            <ul uk-accordion>
                <li class="uk-closed">
                    <a class="uk-accordion-title" href="#">Nytt innlegg</a>
                    <div class="uk-accordion-content">
                        <form method="POST" id="{{ announcement.pk }}-form">
                            {% csrf_token %}
                            <fieldset class="uk-fieldset">

                                <div class="uk-margin">
                                    {{ form }}
                                </div>

                                <input type="submit" value="Send" class="uk-button uk-button-primary">
                            </fieldset>
                        </form>
                    </div>
                </li>
            </ul>
        {% endif %}
        {% for announcement in announcement_list %}
            <article class="uk-comment">
                <header class="uk-comment-header uk-grid-medium uk-flex-middle" uk-grid>
                    <div class="uk-width-auto">
                        <img class="uk-comment-avatar" src="{% static "itsBooking/profile_pics/profile_picture.jpeg" %}"
                             width="80" height="80" alt="">
                    </div>
                    <div class="uk-width-expand">
                        <h4 class="uk-comment-title uk-margin-remove">{{ announcement.title }}
                        </h4>
                        <ul class="uk-comment-meta uk-subnav uk-subnav-divider uk-margin-remove-top">
                            <li><a href="#">{{ announcement.author.get_full_name }}</a></li>
                            <li><a href="#">{{ announcement.timestamp }}</a></li>
                            <li><a href="#">Svar</a></li>
                            {% if request.user == announcement.author %}
                                <li>
                                    <!-- This is a button toggling the modal -->
                                    <button class="uk-button uk-button-small uk-button-default uk-margin-small-right" type="button" uk-toggle="target: #modal-example">Slett kunngjøring</button>

                                    <!-- This is the modal -->
                                    <div id="modal-example" uk-modal>
                                        <div class="uk-modal-dialog uk-modal-body">
                                            <h2 class="uk-modal-title">Slett kunngjøring</h2>
                                            <p>Er du sikker på at du ønsker å slette denne kunngjøringen og alle tilhørende kommentarer? </p>
                                            <div class="uk-modal-footer uk-text-right">
                                                <form method="POST" action="{% url 'delete_announcement' pk=announcement.pk slug=announcement.course.slug %}">
                                                    {% csrf_token %}
                                                    <button class="uk-button uk-button-default uk-modal-close" type="button">Avbryt</button>
                                                    <button class="uk-button uk-button-primary" type="submit">Bekreft</button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                            {% endif %}
                        </ul>
                    </div>
                </header>
                <div class="uk-comment-body">
                    <p>{{ announcement.content }}</p><br>
                </div>
            </article>
        {% empty %}
            <p> Ingen publiserte kunngjøringer</p>
        {% endfor %}
    </div>

{% endblock %}